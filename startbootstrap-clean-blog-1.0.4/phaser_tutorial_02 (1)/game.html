<!doctype html> 
<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
    <title>Phaser - Making your first game, part 9</title>
	<script type="text/javascript" src="phaser.min.js"></script>
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>
<script type ="text/javascript">

var game = new Phaser.Game(800,600, Phaser.AUTO, '',{preload: preload,create: create, update: update});

function preload() {

	game.load.image('pail', 'assets/pail.png');
	game.load.image('banana', 'assets/banana.png');
	game.load.image('sky', 'assets/sky.png');
	game.load.image('ground', 'assets/platform.png');
	game.load.image('dia', 'assets/diamond.png');

}
var basket;
var fruit; 
var cursors;
var score= 0;
var scoreText;
var platform;
var ground;
var fruits;
var emitter; 
var emitter1;
var dia;
var dias;
function create(){
	game.physics.startSystem(Phaser.Physics.ARCADE);
	game.add.sprite(0,0, 'sky');
	platform = game.add.group();
	platform.enableBody = true;
	ground = platform.create(0, game.world.height - 64, 'ground');
	ground.scale.setTo(2,2);
	ground.body.immovable = true;
	game.physics.arcade.enable(ground);
	ground.body.collideWorldBounds = true;
	basket = game.add.sprite(32, game.world.height - 150, 'pail');
	game.physics.arcade.enable(basket);
	basket.body.collideWorldBounds = true;
	dia = game.add.group();
	dia.enableBody = true;
	for(var i = 0; i<5; i++){
	dias = dia.create(i*70, 0,'diamond');
	dias.body.gravity.y = 300;
	}
	fruit = game.add.group();
	fruit.enableBody = true;
	for(var i = 0; i<12; i++){
	fruits = fruit.create(i*70, 0, 'banana');
	fruits.body.gravity.y = 100;
	}
	emitter = game.add.emitter(game.world.centerX, 0, 100);
	emitter.makeParticles('banana');
	emitter.start(false, 5000, 750);
	this.frequency = 5;
	game.time.events.add(Phaser.Timer.SECOND * 2, dropFruit, this);
	scoreText = game.add.text(16,16,'score:0');
	cursors = game.input.keyboard.createCursorKeys();
	
}
function update(){
	
	game.physics.arcade.overlap(basket, fruit, collectFruit, null, this );
	game.physics.arcade.overlap(basket, emitter, collectFruit, null, this );
	game.phsyics.arcade.overlap(basket, emitter1, collectFruit, null, this);
	basket.body.velocity.x = 0;
	if(cursors.left.isDown){
		basket.body.velocity.x=-150;
		basket.animations.play('left');
	}
	else if(cursors.right.isDown){
		basket.body.velocity.x = 150;
		basket.animations.play('right');
	}
	
	else{
	}
	
	
}
function loseFruit (basket, dia){
	dia.kill();
	score = score - 15;
	scoreText.text = 'Score: ' + score;
}
function collectFruit(basket, fruit){
	fruit.kill();
	score += 10;
	scoreText.text = 'Score: ' + score;
}
function dropFruit (){
	emitter1 = game.add.emitter(400, 100, 100);
	emitter1.makeParticles('dia');
	emitter1.start(false, 5000, 100);
	emitter1.frequency = 1;
}

</script>

</body>


</html>